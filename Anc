<?php if (have_rows('bang_gia')): ?>
<section id="bang-gia-tour" class="tour-price-tabs">
  <h2>ðŸ“… Báº£ng giÃ¡ tour</h2>

  <?php
    // Láº¥y cÃ¡c thÃ¡ng cÃ³ trong báº£ng
    $months = [];
    while (have_rows('bang_gia')): the_row();
      $ngay = get_sub_field('ngay_khoi_hanh');
      $month_key = date('Y-m', strtotime($ngay));
      $months[$month_key] = 'ThÃ¡ng ' . (int)date('m', strtotime($ngay));
    endwhile;
    reset_rows(); // quay láº¡i Ä‘áº§u repeater
  ?>

  <div class="month-tabs">
    <button class="tab-btn active" data-month="all">Táº¥t cáº£</button>
    <?php foreach ($months as $key => $label): ?>
      <button class="tab-btn" data-month="<?php echo esc_attr($key); ?>"><?php echo esc_html($label); ?></button>
    <?php endforeach; ?>
  </div>

  <div class="table-wrapper">
    <table class="price-table">
      <thead>
        <tr>
          <th>NgÃ y khá»Ÿi hÃ nh</th>
          <th>Háº¡ng tour</th>
          <th>GiÃ¡ tour</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <?php while (have_rows('bang_gia')): the_row(); 
          $ngay = get_sub_field('ngay_khoi_hanh');
          $hang = get_sub_field('hang_tour');
          $gia = get_sub_field('gia_tour');
          $con_cho = get_sub_field('con_cho');
          $thang = date('Y-m', strtotime($ngay));
        ?>
        <tr data-month="<?php echo esc_attr($thang); ?>">
          <td>
            <?php echo date('d/m/Y', strtotime($ngay)); ?><br>
            <span class="<?php echo ($con_cho === 'con') ? 'available' : 'unavailable'; ?>">
              <?php echo ($con_cho === 'con') ? 'CÃ²n chá»—' : 'KÃ­n chá»—'; ?>
            </span>
          </td>
          <td><?php echo esc_html($hang); ?></td>
          <td>
            <strong><?php echo number_format($gia, 0, ',', '.') . 'Ä‘'; ?></strong><br>
            <small>+ <?php echo number_format($gia * 0.01, 0, ',', '.'); ?> Ä‘iá»ƒm</small>
          </td>
          <td>
            <?php if ($con_cho === 'con'): ?>
              <a href="/thanh-toan?price=<?php echo esc_attr($gia); ?>" class="btn-mua-ngay">Giá»¯ chá»— ngay</a>
            <?php else: ?>
              <a href="#yeu-cau" class="btn-yeu-cau">Gá»­i yÃªu cáº§u</a>
            <?php endif; ?>
          </td>
        </tr>
        <?php endwhile; ?>
      </tbody>
    </table>
  </div>
</section>
<?php endif; ?>
