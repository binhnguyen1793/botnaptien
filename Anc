function hotel_booking_form_shortcode() {
    ob_start();

    $post_id = get_the_ID();
    $tieu_de = get_the_title($post_id);
    $dia_chi = get_field('dia_chi_1', $post_id);

    // L·∫•y th√¥ng tin lo·∫°i ph√≤ng ƒë·∫ßu ti√™n
    $ten_phong = 'Ph√≤ng ti√™u chu·∫©n';
    $dien_tich = '';
    $so_nguoi = '';
    $so_giuong = '';
    $gia_phong = 1000000;

    if (have_rows('loai_phong', $post_id)) {
        the_row(); // L·∫•y ph√≤ng ƒë·∫ßu ti√™n
        $ten_phong = get_sub_field('ten_phong') ?: $ten_phong;
        $dien_tich = get_sub_field('dien_tich_phong');
        $so_nguoi = get_sub_field('so_nguoi');
        $so_giuong = get_sub_field('so_giuong');
        $gia_phong = get_sub_field('gia_tour');
    }
    ?>

    <div class="hotel-booking-box">
        <h2>Chi ti·∫øt ƒë·∫∑t ph√≤ng</h2>
        <h3><?php echo esc_html($tieu_de); ?></h3>
        <p>üìç <?php echo esc_html($dia_chi); ?></p>

        <div class="checkin-checkout-row">
            <div class="date-group">
                <label>Ng√†y nh·∫≠n ph√≤ng:</label>
                <input type="date" id="checkin" required>
            </div>
            <div class="date-group">
                <label>Ng√†y tr·∫£ ph√≤ng:</label>
                <input type="date" id="checkout" required>
            </div>
        </div>

        <!-- S·ªë ph√≤ng -->
        <div class="room-quantity">
            <label for="so-phong">S·ªë ph√≤ng:</label>
            <div class="qty-wrapper">
                <button type="button" class="qty-btn" id="minus">‚àí</button>
                <input type="number" id="so-phong" value="1" min="1" step="1">
                <button type="button" class="qty-btn plus" id="plus">+</button>
            </div>
        </div>

        <div class="booking-table">
            <div class="booking-row header">
                <div>S·ªë ƒë√™m ph√≤ng</div>
                <div>Lo·∫°i ph√≤ng</div>
                <div>ƒêi·ªÅu ki·ªán ph√≤ng</div>
                <div>Gi∆∞·ªùng ph·ª•</div>
                <div>Gi√° ph√≤ng/ƒë√™m</div>
            </div>
            <div class="booking-row">
                <div><span id="so-dem">1 ph√≤ng x 1 ƒë√™m</span></div>
                <div>
                    <?php echo esc_html($ten_phong); ?><br>
                    Di·ªán t√≠ch <?php echo esc_html($dien_tich); ?>m¬≤, <?php echo esc_html($so_giuong); ?> gi∆∞·ªùng<br>
                    <a href="#">Xem chi ti·∫øt</a>
                </div>
                <div>
                    Ph√≤ng d√†nh cho <?php echo esc_html($so_nguoi); ?> kh√°ch<br>
                    ƒê√£ bao g·ªìm ƒÉn s√°ng<br>
                    <b>CH∆ØA</b> bao g·ªìm thu·∫ø VAT v√† ph√≠ d·ªãch v·ª•<br>
                    <span style="color:red">Kh√¥ng ho√†n/h·ªßy ph√≤ng</span>
                </div>
                <div>
                    <select><option>0</option><option>1</option><option>2</option></select>
                </div>
                <div><b><?php echo number_format($gia_phong, 0, ',', '.'); ?>ƒë</b></div>
            </div>
        </div>

        <div class="booking-summary">
            <div class="summary-line">
                <span id="room-summary">1 <?php echo esc_html($ten_phong); ?></span>
                <span id="tien-phong"><?php echo number_format($gia_phong, 0, ',', '.'); ?>ƒë</span>
            </div>
            <div class="summary-line">
                <span>Thu·∫ø & ph√≠</span>
                <span id="thue-phi">463.000ƒë</span>
            </div>
            <div class="discount-box">
                <input type="text" placeholder="Nh·∫≠p m√£ gi·∫£m gi√°">
            </div>
            <div class="summary-line total">
                <span>T·ªïng ti·ªÅn:</span>
                <span style="color: red; font-weight: bold;" id="tong-tien">...</span>
            </div>
            <p><strong>+ <span id="diem-thuong">...</span> ƒëi·ªÉm</strong></p>
        </div>

        <hr style="margin: 30px 0;">
        <div class="contact-info">
            <h3>Th√¥ng tin Li√™n h·ªá</h3>
            <form>
                <div class="gender-options">
                    <label class="gender-label">Qu√Ω danh*:</label>
                    <label><input type="radio" name="gender" required> √îng</label>
                    <label><input type="radio" name="gender"> B√†</label>
                    <label><input type="radio" name="gender"> Anh</label>
                    <label><input type="radio" name="gender"> Ch·ªã</label>
                </div>

                <input type="text" placeholder="H·ªç v√† t√™n" required style="width: 100%; padding: 8px;"><br><br>
                <input type="text" placeholder="S·ªë ƒëi·ªán tho·∫°i*" required style="width: 48%; padding: 8px; display: inline-block; margin-right: 4%;">
                <input type="email" placeholder="Email" style="width: 48%; padding: 8px; display: inline-block;"><br><br>
                <textarea placeholder="N·ªôi dung y√™u c·∫ßu" style="width: 100%; height: 80px; padding: 8px;"></textarea><br><br>
                <label><input type="checkbox"> T√¥i mu·ªën xu·∫•t h√≥a ƒë∆°n ƒë·ªè.</label><br><br>

                <p style="font-size: 13px;">* Khi Qu√Ω kh√°ch nh·∫•n n√∫t "G·ª≠i y√™u c·∫ßu ƒë·∫∑t ph√≤ng" c≈©ng ƒë·ªìng nghƒ©a l√† Qu√Ω kh√°ch ƒë√£ ƒë·ªìng √Ω v·ªõi c√°c <a href="#" target="_blank">ƒëi·ªÅu kho·∫£n v√† ƒëi·ªÅu ki·ªán</a>.</p>

                <button type="submit" style="background-color: #ff7800; color: white; padding: 12px 25px; font-size: 16px; border: none; cursor: pointer;">G·ª≠i y√™u c·∫ßu ƒë·∫∑t ph√≤ng</button>
            </form>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const checkin = document.getElementById('checkin');
        const checkout = document.getElementById('checkout');
        const soPhongInput = document.getElementById('so-phong');
        const btnMinus = document.getElementById('minus');
        const btnPlus = document.getElementById('plus');
        const giaPhong = <?php echo intval($gia_phong); ?>;
        const thuePhi = 463000;

        const today = new Date();
        const tomorrow = new Date();
        tomorrow.setDate(today.getDate() + 1);

        const todayStr = today.toISOString().split('T')[0];
        const tomorrowStr = tomorrow.toISOString().split('T')[0];

        checkin.value = todayStr;
        checkout.value = tomorrowStr;
        checkout.min = tomorrowStr;

        function updatePrice() {
            const inDate = new Date(checkin.value);
            const outDate = new Date(checkout.value);
            const soPhong = parseInt(soPhongInput.value) || 1;

            if (!checkin.value || !checkout.value || outDate <= inDate) {
                document.getElementById('so-dem').innerText = `${soPhong} ph√≤ng x ? ƒë√™m`;
                document.getElementById('room-summary').innerText = `${soPhong} ph√≤ng`;
                document.getElementById('tien-phong').innerText = '...';
                document.getElementById('tong-tien').innerText = '...';
                document.getElementById('diem-thuong').innerText = '...';
                return;
            }

            const soDem = Math.ceil((outDate - inDate) / (1000 * 60 * 60 * 24));
            const tienPhong = giaPhong * soDem * soPhong;
            const tong = tienPhong + thuePhi;
            const diem = Math.round(tong * 0.01);

            document.getElementById('so-dem').innerText = `${soPhong} ph√≤ng x ${soDem} ƒë√™m`;
            document.getElementById('room-summary').innerText = `${soPhong} <?php echo esc_js($ten_phong); ?>`;
            document.getElementById('tien-phong').innerText = tienPhong.toLocaleString('vi-VN') + 'ƒë';
            document.getElementById('tong-tien').innerText = tong.toLocaleString('vi-VN') + 'ƒë';
            document.getElementById('diem-thuong').innerText = diem.toLocaleString('vi-VN');
        }

        checkin.addEventListener('change', () => {
            const inDate = new Date(checkin.value);
            const minCheckout = new Date(inDate);
            minCheckout.setDate(minCheckout.getDate() + 1);
            checkout.min = minCheckout.toISOString().split('T')[0];
            if (new Date(checkout.value) <= inDate) {
                checkout.value = checkout.min;
            }
            updatePrice();
        });

        checkout.addEventListener('change', updatePrice);
        btnMinus.addEventListener('click', () => {
            let val = Math.max(1, parseInt(soPhongInput.value) - 1);
            soPhongInput.value = val;
            updatePrice();
        });
        btnPlus.addEventListener('click', () => {
            let val = parseInt(soPhongInput.value) + 1;
            soPhongInput.value = val;
            updatePrice();
        });

        updatePrice();
    });
    </script>

    <style>
    /* (Gi·ªØ nguy√™n to√†n b·ªô CSS t·ª´ phi√™n b·∫£n b·∫°n ƒë√£ l√†m, ho·∫∑c g·ªçn nh·∫π h∆°n n·∫øu c·∫ßn) */
    </style>

    <?php
    return ob_get_clean();
}
add_shortcode('hotel_booking_form', 'hotel_booking_form_shortcode');
