<?php while (have_posts()) : the_post(); ?>
  <?php
    $content = apply_filters('the_content', get_the_content());
    preg_match_all('/<h([2-4])[^>]*>(.*?)<\/h[2-4]>/', $content, $matches, PREG_SET_ORDER);

    foreach ($matches as $index => $heading) {
      $level = $heading[1];
      $title = strip_tags($heading[2]);
      $slug = 'toc-' . $index;
      $content = preg_replace(
        '/' . preg_quote($heading[0], '/') . '/',
        '<h' . $level . ' id="' . $slug . '">' . $heading[2] . '</h' . $level . '>',
        $content,
        1
      );
      $toc_items[] = [
        'slug' => $slug,
        'title' => $title,
        'level' => $level
      ];
    }
  ?>
  <section class="hotel-article-section">
    <div class="container">
      <div class="hotel-article-wrapper">
        <aside class="hotel-article-sidebar">
          <div class="hotel-toc">
            <h3>Thông tin chi tiết</h3>
            <ul>
              <?php foreach ($toc_items as $item): ?>
                <li class="toc-level-<?php echo $item['level']; ?>">
                  <a href="#<?php echo esc_attr($item['slug']); ?>"><?php echo esc_html($item['title']); ?></a>
                </li>
              <?php endforeach; ?>
            </ul>
          </div>
        </aside>
        <article class="hotel-article-content">
          <?php echo $content; ?>
        </article>
      </div>
    </div>
  </section>
<?php endwhile; ?>
