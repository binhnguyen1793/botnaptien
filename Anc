function tour_search_form_shortcode() {
    ob_start(); ?>

    <style>
    .tour-search-wrapper {
        max-width: 1140px;
        margin: 0 auto;
        padding: 0 16px;
        margin-top: 32px;
    }

    .tour-search-title {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 12px;
        border-bottom: 1px solid #eee;
        padding-bottom: 8px;
        color: #333;
    }

    .tour-search-form {
        background: #fff;
        padding: 20px 24px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        display: flex;
        gap: 16px;
        align-items: flex-end;
        flex-wrap: wrap;
    }

    .tour-search-form .form-group {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .tour-search-form label {
        font-weight: 600;
        font-size: 11px;
        text-transform: uppercase;
        color: #999;
        margin-bottom: 4px;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .tour-search-form label::before {
        content: "üìç"; /* ho·∫∑c thay icon n·∫øu c·∫ßn */
        font-size: 14px;
    }

    .tour-search-form select {
        padding: 10px 14px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 14px;
        color: #333;
    }

    .tour-search-form select:invalid {
        color: #999;
    }

    .tour-search-form button {
        padding: 12px 28px;
        background-color: #e1703a;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-weight: bold;
        font-size: 15px;
        cursor: pointer;
        flex-shrink: 0;
    }

    @media (max-width: 768px) {
        .tour-search-form {
            flex-direction: column;
            align-items: stretch;
        }

        .tour-search-form button {
            width: 100%;
        }
    }
    </style>

    <div class="tour-search-wrapper">
        <div class="tour-search-title">T√¨m tour gi√° t·ªët</div>
        <form onsubmit="return false;" class="tour-search-form">

            <!-- ƒê·ªãa ƒëi·ªÉm -->
            <div class="form-group">
                <label>ƒê·ªãa ƒëi·ªÉm</label>
                <select name="diadiem" required>
                    <option value="" disabled selected hidden>B·∫°n mu·ªën ƒëi ƒë√¢u?</option>
                    <?php
                    $terms = get_terms([
                        'taxonomy' => 'vung_mien_tour',
                        'hide_empty' => false,
                    ]);
                    foreach ($terms as $term) {
                        $slug_parts = [];
                        $current = $term;
                        while ($current && $current->parent != 0) {
                            array_unshift($slug_parts, $current->slug);
                            $current = get_term($current->parent, 'vung_mien_tour');
                        }
                        if ($current) {array_unshift($slug_parts, $current->slug);
                        }
                        $full_slug = implode('/', $slug_parts);
                        echo '<option value="' . esc_attr($term->slug) . '" data-full-slug="' . esc_attr($full_slug) . '">' . esc_html($term->name) . '</option>';
                    }
                    ?>
                </select>
            </div>

            <!-- Kh·ªüi h√†nh -->
            <div class="form-group">
                <label>Kh·ªüi h√†nh t·ª´</label>
                <select name="khoihanh" required>
                    <option value="" disabled selected hidden>Vui l√≤ng ch·ªçn</option>
                    <option value="ha-noi">H√† N·ªôi</option>
                    <option value="ho-chi-minh">H·ªì Ch√≠ Minh</option>
                    <option value="da-nang">ƒê√† N·∫µng</option>
                    <option value="hai-phong">H·∫£i Ph√≤ng</option>
                </select>
            </div>

            <!-- N√∫t -->
            <div style="flex: 0 0 auto;">
                <button type="submit">T√¨m ngay</button>
            </div>
        </form>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('.tour-search-form');
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const select = form.querySelector('[name="diadiem"]');
            const slug = select.options[select.selectedIndex].getAttribute('data-full-slug');
            if (slug) {
                window.location.href = '/vung_mien_tour/' + slug + '/';
            }
        });
    });
    </script>

    <?php
    return ob_get_clean();
}
add_shortcode('tour_search_form', 'tour_search_form_shortcode');
